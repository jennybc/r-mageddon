---
title: The Burger King Pandemic
author: ''
date: '2018-08-12'
slug: the-burger-king-pandemic
categories: []
tags:
  - data wrangling
  - R
  - visualisation
  - tidyverse
  - gifski
  - animation
  - rvest
  - glue
  - geospatial
description: ''
thumbnail: ''
---



<p>Whilst I was rooting around for inspiration, my girlfriend suggested I should do a post about food, quickly followed up by “burgers!!!”. So a few google searches later and I decided to create an animated map, showing all the countries of the world that had at least one Burger King store.</p>
<p>I’m particularly chuffed that I’ve managed to combine a multitude of really cool packages in this post. We’ve got:</p>
<ul>
<li>Data scraped off Wikipedia using the <code>rvest</code> <a href="https://cran.r-project.org/web/packages/rvest/rvest.pdf">package</a> in conjunction with the <code>purr</code> <a href="https://cran.r-project.org/web/packages/purrr/purrr.pdf">package</a>.</li>
<li>Some classic data manipulation using the wonders of the <a href="https://www.tidyverse.org/">tidyverse</a></li>
<li>Using the <code>glue</code> <a href="https://cran.r-project.org/web/packages/glue/glue.pdf">package</a> to format and interpolate strings.</li>
<li>Creating a geospatial visualisation using the new <code>ggplot2</code> <a href="https://ggplot2.tidyverse.org/">release</a>, with the <code>sf</code> <a href="https://cran.r-project.org/web/packages/sf/sf.pdf">package</a> and obtaining data from the <code>rnaturalearth</code> <a href="https://cran.r-project.org/web/packages/rnaturalearth/README.html">package</a>.</li>
<li>Animating the visualisation using the <code>gifski</code> <a href="https://cran.r-project.org/web/packages/gifski/gifski.pdf">package</a></li>
</ul>
<p>Ok so lets get started.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages ----------------------------------------------------------------------------------------------------------------------------- tidyverse 1.2.1 --</code></pre>
<pre><code>## v ggplot2 3.0.0     v purrr   0.2.4
## v tibble  1.4.2     v dplyr   0.7.4
## v tidyr   0.8.0     v stringr 1.3.1
## v readr   1.1.1     v forcats 0.3.0</code></pre>
<pre><code>## -- Conflicts -------------------------------------------------------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(rvest)</code></pre>
<pre><code>## Loading required package: xml2</code></pre>
<pre><code>## 
## Attaching package: &#39;rvest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     pluck</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     guess_encoding</code></pre>
<pre class="r"><code>library(sf)</code></pre>
<pre><code>## Linking to GEOS 3.6.1, GDAL 2.2.3, proj.4 4.9.3</code></pre>
<pre class="r"><code>library(glue)</code></pre>
<pre><code>## 
## Attaching package: &#39;glue&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse</code></pre>
<pre class="r"><code>library(rnaturalearth)
library(gifski)</code></pre>
<p>Firstly I’ve located the data I want, a Wikipedia <a href="https://en.wikipedia.org/wiki/List_of_countries_with_Burger_King_franchises">page</a> that lists the countries with Burger King franchises.</p>
<pre class="r"><code>url &lt;- &quot;https://en.wikipedia.org/wiki/List_of_countries_with_Burger_King_franchises&quot;</code></pre>
<p>Now to scrape the data from each table we need to know the Xpath or CSS selector. Normally I would use the Selector Gadget chrome addin to get the selector, (à la this <a href="http://categitau.com/using-rvest-to-scrape-data-from-wikipedia/">blog</a>), but I couldn’t get it to work. So I inspected the element of the first table and got <code>'//*[@id=&quot;mw-content-text&quot;]/div/table[2]')</code>. A quick scroll down and I figured out I want tables 2 - 8. So to iterate through these 7 tables, I constructed a function to extract the data.</p>
<pre class="r"><code>extract_table_df &lt;- function(table_no){
  table &lt;- url %&gt;%
    read_html() %&gt;%
    html_nodes(xpath = glue(&#39;//*[@id=&quot;mw-content-text&quot;]/div/table[{table_no}]&#39;)) %&gt;%
    html_table()
  table_df &lt;- table[[1]] %&gt;%
    mutate(Yearentered = as.character(Yearentered))
}</code></pre>
<p>Now we can use this function combined with the <code>purrr</code> function <code>map_dfr</code> to iterate through the 8 tables and bind them together.</p>
<pre class="r"><code>data &lt;- map_dfr(2:8, extract_table_df)
glimpse(data)</code></pre>
<pre><code>## Observations: 119
## Variables: 5
## $ `Country/territory` &lt;chr&gt; &quot;Egypt&quot;, &quot;Ghana&quot;, &quot;Ivory Coast&quot;, &quot;Kenya&quot;, ...
## $ Yearentered         &lt;chr&gt; &quot;2007&quot;, &quot;2018&quot;, &quot;2015&quot;, &quot;2016&quot;, &quot;2011&quot;, &quot;2...
## $ Masterfranchisee    &lt;chr&gt; &quot;Olayan Group&quot;, &quot;SIA QSR Ghana Ltd.[19]&quot;, ...
## $ Notes               &lt;chr&gt; &quot;Olayan&#39;s food service subsidiary, Hana In...
## $ Country             &lt;chr&gt; NA, NA, NA, NA, NA, NA, &quot;Afghanistan&quot;, &quot;Ba...</code></pre>
<p>A quick inspection of the data shows a few things. We have unexpectedly brought the reference numbers with us, which makes the year column wrong and some tables had country/territory, whilst others simply contained country. And some observations have no year at all.</p>
<p>So lets fix that!</p>
<pre class="r"><code>tidy_data &lt;- data %&gt;%
  mutate(country = ifelse(is.na(Country), `Country/territory`, Country)) %&gt;%
  mutate(year = as.numeric(str_sub(Yearentered, end=4))) %&gt;%
  filter(!is.na(year))</code></pre>
<p>Now we have the data as we need it, right?</p>
<p>Lets now get the spatial data we need to plot the results. This comes from the very handy <code>rnaturalearth</code> package.</p>
<pre class="r"><code>countries_sf &lt;- ne_countries(scale = &quot;medium&quot;, returnclass = &quot;sf&quot;)
glimpse(countries_sf)</code></pre>
<pre><code>## Observations: 241
## Variables: 95
## $ featurecla &lt;chr&gt; &quot;Admin-0 country&quot;, &quot;Admin-0 country&quot;, &quot;Admin-0 coun...
## $ scalerank  &lt;int&gt; 1, 1, 1, 3, 5, 6, 1, 1, 1, 3, 5, 3, 3, 3, 3, 1, 5, ...
## $ labelrank  &lt;int&gt; 3, 3, 3, 2, 3, 6, 4, 3, 4, 6, 6, 6, 6, 6, 4, 5, 2, ...
## $ sovereignt &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ sov_a3     &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ adm0_dif   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, ...
## $ level      &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, ...
## $ type       &lt;chr&gt; &quot;Sovereign country&quot;, &quot;Sovereign country&quot;, &quot;Sovereig...
## $ admin      &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ adm0_a3    &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ geou_dif   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
## $ geounit    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ gu_a3      &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ su_dif     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
## $ subunit    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ su_a3      &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ brk_diff   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
## $ name       &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ name_long  &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ brk_a3     &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ brk_name   &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ brk_group  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ abbrev     &lt;chr&gt; &quot;Zimb.&quot;, &quot;Zambia&quot;, &quot;Yem.&quot;, &quot;Viet.&quot;, &quot;Ven.&quot;, &quot;Vat.&quot;,...
## $ postal     &lt;chr&gt; &quot;ZW&quot;, &quot;ZM&quot;, &quot;YE&quot;, &quot;VN&quot;, &quot;VE&quot;, &quot;V&quot;, &quot;VU&quot;, &quot;UZ&quot;, &quot;UY&quot;...
## $ formal_en  &lt;chr&gt; &quot;Republic of Zimbabwe&quot;, &quot;Republic of Zambia&quot;, &quot;Repu...
## $ formal_fr  &lt;chr&gt; NA, NA, NA, NA, &quot;República Bolivariana de Venezuela...
## $ name_ciawf &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ note_adm0  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, &quot;Common...
## $ note_brk   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ name_sort  &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen, Rep.&quot;, &quot;Vietnam&quot;, &quot;Ve...
## $ name_alt   &lt;chr&gt; NA, NA, NA, NA, NA, &quot;Holy See&quot;, NA, NA, NA, NA, NA,...
## $ mapcolor7  &lt;int&gt; 1, 5, 5, 5, 1, 1, 6, 2, 1, 5, 2, 4, 4, 4, 4, 4, 4, ...
## $ mapcolor8  &lt;int&gt; 5, 8, 3, 6, 3, 3, 3, 3, 2, 2, 5, 5, 5, 5, 5, 5, 5, ...
## $ mapcolor9  &lt;int&gt; 3, 5, 3, 5, 1, 4, 7, 5, 2, 4, 5, 1, 1, 1, 1, 1, 1, ...
## $ mapcolor13 &lt;int&gt; 9, 13, 11, 4, 4, 2, 3, 4, 10, 13, 3, 1, 1, 1, 1, 1,...
## $ pop_est    &lt;chr&gt; &quot;13805084&quot;, &quot;15972000&quot;, &quot;28036829&quot;, &quot;96160163&quot;, &quot;31...
## $ pop_rank   &lt;int&gt; 14, 14, 15, 16, 15, 3, 10, 15, 12, 9, 8, 8, 9, 9, 8...
## $ gdp_md_est &lt;dbl&gt; 2.833e+04, 6.517e+04, 7.345e+04, 5.949e+05, 4.686e+...
## $ pop_year   &lt;int&gt; 2017, 2017, 2017, 2017, 2017, 2015, 2017, 2017, 201...
## $ lastcensus &lt;int&gt; 2002, 2010, 2004, 2009, 2001, NA, 2009, 1989, 2004,...
## $ gdp_year   &lt;int&gt; 2016, 2016, 2016, 2016, 2016, 0, 2016, 2016, 2016, ...
## $ economy    &lt;chr&gt; &quot;5. Emerging region: G20&quot;, &quot;7. Least developed regi...
## $ income_grp &lt;chr&gt; &quot;5. Low income&quot;, &quot;4. Lower middle income&quot;, &quot;4. Lowe...
## $ wikipedia  &lt;int&gt; NA, NA, NA, NA, NA, 0, NA, NA, NA, NA, NA, NA, NA, ...
## $ fips_10_   &lt;chr&gt; &quot;ZI&quot;, &quot;ZA&quot;, &quot;YM&quot;, &quot;VM&quot;, &quot;VE&quot;, &quot;VT&quot;, &quot;NH&quot;, &quot;UZ&quot;, &quot;UY...
## $ iso_a2     &lt;chr&gt; &quot;ZW&quot;, &quot;ZM&quot;, &quot;YE&quot;, &quot;VN&quot;, &quot;VE&quot;, &quot;VA&quot;, &quot;VU&quot;, &quot;UZ&quot;, &quot;UY...
## $ iso_a3     &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ iso_a3_eh  &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ iso_n3     &lt;chr&gt; &quot;716&quot;, &quot;894&quot;, &quot;887&quot;, &quot;704&quot;, &quot;862&quot;, &quot;336&quot;, &quot;548&quot;, &quot;8...
## $ un_a3      &lt;chr&gt; &quot;716&quot;, &quot;894&quot;, &quot;887&quot;, &quot;704&quot;, &quot;862&quot;, &quot;336&quot;, &quot;548&quot;, &quot;8...
## $ wb_a2      &lt;chr&gt; &quot;ZW&quot;, &quot;ZM&quot;, &quot;RY&quot;, &quot;VN&quot;, &quot;VE&quot;, NA, &quot;VU&quot;, &quot;UZ&quot;, &quot;UY&quot;,...
## $ wb_a3      &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, NA, &quot;VUT&quot;, &quot;UZB&quot;...
## $ woe_id     &lt;int&gt; 23425004, 23425003, 23425002, 23424984, 23424982, 2...
## $ woe_id_eh  &lt;int&gt; 23425004, 23425003, 23425002, 23424984, 23424982, 2...
## $ woe_note   &lt;chr&gt; &quot;Exact WOE match as country&quot;, &quot;Exact WOE match as c...
## $ adm0_a3_is &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ adm0_a3_us &lt;chr&gt; &quot;ZWE&quot;, &quot;ZMB&quot;, &quot;YEM&quot;, &quot;VNM&quot;, &quot;VEN&quot;, &quot;VAT&quot;, &quot;VUT&quot;, &quot;U...
## $ adm0_a3_un &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ adm0_a3_wb &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ continent  &lt;chr&gt; &quot;Africa&quot;, &quot;Africa&quot;, &quot;Asia&quot;, &quot;Asia&quot;, &quot;South America&quot;...
## $ region_un  &lt;chr&gt; &quot;Africa&quot;, &quot;Africa&quot;, &quot;Asia&quot;, &quot;Asia&quot;, &quot;Americas&quot;, &quot;Eu...
## $ subregion  &lt;chr&gt; &quot;Eastern Africa&quot;, &quot;Eastern Africa&quot;, &quot;Western Asia&quot;,...
## $ region_wb  &lt;chr&gt; &quot;Sub-Saharan Africa&quot;, &quot;Sub-Saharan Africa&quot;, &quot;Middle...
## $ name_len   &lt;int&gt; 8, 6, 5, 7, 9, 7, 7, 10, 7, 10, 12, 14, 15, 4, 14, ...
## $ long_len   &lt;int&gt; 8, 6, 5, 7, 9, 7, 7, 10, 7, 30, 16, 24, 28, 4, 14, ...
## $ abbrev_len &lt;int&gt; 5, 6, 4, 5, 4, 4, 4, 4, 4, 6, 6, 6, 11, 4, 9, 4, 6,...
## $ tiny       &lt;int&gt; NA, NA, NA, 2, NA, 4, 2, 5, NA, NA, 2, 3, 3, 2, 3, ...
## $ homepart   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, NA, NA, NA, NA, NA...
## $ min_zoom   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
## $ min_label  &lt;dbl&gt; 3.0, 3.0, 3.0, 2.0, 3.0, 5.0, 4.0, 3.0, 3.0, 5.0, 5...
## $ max_label  &lt;dbl&gt; 8.0, 8.0, 8.0, 7.0, 7.5, 10.0, 9.0, 8.0, 8.0, 10.0,...
## $ ne_id      &lt;chr&gt; &quot;1159321441&quot;, &quot;1159321439&quot;, &quot;1159321425&quot;, &quot;11593214...
## $ wikidataid &lt;chr&gt; &quot;Q954&quot;, &quot;Q953&quot;, &quot;Q805&quot;, &quot;Q881&quot;, &quot;Q717&quot;, &quot;Q237&quot;, &quot;Q6...
## $ name_ar    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ name_bn    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ name_de    &lt;chr&gt; &quot;Simbabwe&quot;, &quot;Sambia&quot;, &quot;Jemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ name_en    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ name_es    &lt;chr&gt; &quot;Zimbabue&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ name_fr    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambie&quot;, &quot;Yémen&quot;, &quot;Viêt Nam&quot;, &quot;Venezue...
## $ name_el    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ name_hi    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ name_hu    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Jemen&quot;, &quot;Vietnám&quot;, &quot;Venezuel...
## $ name_id    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yaman&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ name_it    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ name_ja    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ name_ko    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ name_nl    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Jemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ name_pl    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Jemen&quot;, &quot;Wietnam&quot;, &quot;Wenezuel...
## $ name_pt    &lt;chr&gt; &quot;Zimbábue&quot;, &quot;Zâmbia&quot;, &quot;Iémen&quot;, &quot;Vietname&quot;, &quot;Venezue...
## $ name_ru    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ name_sv    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Jemen&quot;, &quot;Vietnam&quot;, &quot;Venezuel...
## $ name_tr    &lt;chr&gt; &quot;Zimbabve&quot;, &quot;Zambiya&quot;, &quot;Yemen&quot;, &quot;Vietnam&quot;, &quot;Venezue...
## $ name_vi    &lt;chr&gt; &quot;Zimbabwe&quot;, &quot;Zambia&quot;, &quot;Yemen&quot;, NA, &quot;Venezuela&quot;, &quot;Th...
## $ name_zh    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ geometry   &lt;MULTIPOLYGON [Â°]&gt; MULTIPOLYGON (((31.28789 -2..., MULTI...</code></pre>
<p>A quick glimpse at the data shows a <code>name_en</code> variable that should hopefully match with our <code>country</code> variable in our previous dataset. However what if some of the country names don’t match up?</p>
<pre class="r"><code>mismatches &lt;- tidy_data %&gt;%
  anti_join(countries_sf, by  = c(&quot;country&quot; = &quot;name_en&quot;))
mismatches</code></pre>
<pre><code>##   Country/territory Yearentered        Masterfranchisee
## 1              &lt;NA&gt;        2005                        
## 2              &lt;NA&gt;        2013     Fast Food Timor Lda
## 3         Macedonia        2011                TAB Gida
## 4     United States    19541957 Burger King Corporation
##                                                                                                                                       Notes
## 1                                                         &lt;U+6C49&gt;&lt;U+5821&gt;&lt;U+738B&gt; (in Chinese)12,000th location opened in Beijing.[36][37]
## 2                                                                                                                                          
## 3 The first Burger King restaurant in the Republic of Macedonia was opened in August 2011, and is located at the Skopje airport. 5 outlets.
## 4                                                                Founded as Insta-Burger King in 1954; purchased in 1957 by current company
##       Country       country year
## 1       China         China 2005
## 2 Timor-Leste   Timor-Leste 2013
## 3        &lt;NA&gt;     Macedonia 2011
## 4        &lt;NA&gt; United States 1954</code></pre>
<p>Uh-oh, 4 countries don’t match up. As its a small amount it seemed appropriate to define a new dataset for these countries.</p>
<pre class="r"><code>country_match &lt;- tribble(
  ~country, ~sf_country,
  &quot;United States&quot;, &quot;United States of America&quot;,
  &quot;Macedonia&quot;, &quot;Republic of Macedonia&quot;,
  &quot;Timor-Leste&quot;, &quot;East Timor&quot;,
  &quot;China&quot;, &quot;People&#39;s Republic of China&quot;)
country_match</code></pre>
<pre><code>## # A tibble: 4 x 2
##   country       sf_country                
##   &lt;chr&gt;         &lt;chr&gt;                     
## 1 United States United States of America  
## 2 Macedonia     Republic of Macedonia     
## 3 Timor-Leste   East Timor                
## 4 China         People&#39;s Republic of China</code></pre>
<p>We can now completely join the spatial data to the important data.</p>
<pre class="r"><code>joined_data &lt;- 
  tidy_data %&gt;%
  left_join(country_match) %&gt;%
  mutate(country = ifelse(is.na(sf_country), country, sf_country)) %&gt;%
  left_join(countries_sf,  by  = c(&quot;country&quot; = &quot;name_en&quot;))</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<p>Now we have all of data in one dataframe!</p>
<p>Firstly lets show a quick plot of the countries, using ggplot and sf.</p>
<pre class="r"><code>ggplot() + geom_sf(data = countries_sf) </code></pre>
<p><img src="/post/2018-08-12-the-burger-king-pandemic_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>And now lets pull all the pieces together.</p>
<pre class="r"><code>plot_fun &lt;- function(open_year){
p &lt;- ggplot() + geom_sf(data = filter(countries_sf, name_en != &quot;Antarctica&quot;)) + 
  geom_sf(data = filter(tidy_data3, year &lt;= open_year), aes(fill = rgb(236, 28, 36, maxColorValue = 255))) + 
  theme_void() + coord_sf(datum=NA) + guides(fill=FALSE) + 
  labs(title = glue(&quot;    Countries with a Burger King, year: {open_year}&quot;),
       subtitle = glue(&quot;      Count of countries: {nrow(filter(tidy_data3, year &lt;= open_year))}&quot;))
print(p)
}</code></pre>
<pre class="r"><code>save_gif(walk(min(tidy_data3$year):max(tidy_data3$year), plot_fun), delay = 0.5, gif_file = &quot;animation.gif&quot;)</code></pre>
<p>And we get the final output:</p>
<div class="figure">
<img src="/img/bk.gif" alt="Burger King Animation" />
<p class="caption">Burger King Animation</p>
</div>
<p>P.S. I did quickly briefly add in a <code>transition_time(year)</code> using gganimate, just to experiment and see what happenes. Surprisingly it did make something!</p>
<div class="figure">
<img src="/img/bk2.gif" />

</div>
